<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>client/protocols/arrays/share.js - JIFF Library Documentation</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/multiparty/jiff" target="_blank" class="menu-item" id="github_link" >Github Repo</a></h2><h2><a href="./intro.html" target="_self" class="menu-item" id="github_link" >Tutorial</a></h2><h2><a href="./contributing.html" target="_self" class="menu-item" id="github_link" >Contributing to JIFF</a></h2><h3>Classes</h3><ul><li><a href="GuardedSocket.html">GuardedSocket</a><ul class='methods'><li data-type='method'><a href="GuardedSocket.html#disconnect">disconnect</a></li><li data-type='method'><a href="GuardedSocket.html#is_empty">is_empty</a></li><li data-type='method'><a href="GuardedSocket.html#resend_mailbox">resend_mailbox</a></li><li data-type='method'><a href="GuardedSocket.html#safe_disconnect">safe_disconnect</a></li><li data-type='method'><a href="GuardedSocket.html#safe_emit">safe_emit</a></li></ul></li><li><a href="helpers.Deferred.html">Deferred</a><ul class='methods'><li data-type='method'><a href="helpers.Deferred.html#reject">reject</a></li><li data-type='method'><a href="helpers.Deferred.html#resolve">resolve</a></li></ul></li><li><a href="module-jiff-client-JIFFClient.html">JIFFClient</a><ul class='methods'><li data-type='method'><a href="module-jiff-client-JIFFClient.html#add_to_barriers">add_to_barriers</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#apply_extension">apply_extension</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#can_apply_extension">can_apply_extension</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#connect">connect</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#disconnect">disconnect</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#emit">emit</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#end_barrier">end_barrier</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#executePreprocessing">executePreprocessing</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#extension_applied">extension_applied</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#free">free</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#from_crypto_provider">from_crypto_provider</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#gen_op_id">gen_op_id</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#gen_op_id2">gen_op_id2</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#gen_op_id2_preprocessing">gen_op_id2_preprocessing</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#gen_op_id_preprocessing">gen_op_id_preprocessing</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#get_preprocessing">get_preprocessing</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#has_extension">has_extension</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#has_preprocessing">has_preprocessing</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#internal_open">internal_open</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#internal_share">internal_share</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#isInitialized">isInitialized</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#isReady">isReady</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#listen">listen</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#open">open</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#open_array">open_array</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#open_ND_array">open_ND_array</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#preprocessing">preprocessing</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#preprocessingDaemon">preprocessingDaemon</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#receive_open">receive_open</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#receive_open">receive_open</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#remove_listener">remove_listener</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#reshare">reshare</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#seed_ids">seed_ids</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#share">share</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#share_2D_array">share_2D_array</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#share_array">share_array</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#share_ND_array">share_ND_array</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#share_ND_array_deferred">share_ND_array_deferred</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#share_ND_array_static">share_ND_array_static</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#start_barrier">start_barrier</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient.html#store_preprocessing">store_preprocessing</a></li></ul></li><li><a href="module-jiff-client-JIFFClient_SecretShare.html">SecretShare</a><ul class='methods'><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#add">add</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#bit_decomposition">bit_decomposition</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cadd">cadd</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cdiv">cdiv</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cdivfac">cdivfac</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#ceq">ceq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cgt">cgt</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cgteqn">cgteqn</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#clt">clt</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#clteq">clteq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cmult">cmult</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cneq">cneq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cor_bit">cor_bit</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cpow">cpow</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#csub">csub</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#cxor_bit">cxor_bit</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#div">div</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#eq">eq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#error">error</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#gt">gt</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#gteq">gteq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#if_else">if_else</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#isConstant">isConstant</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#logLEAK">logLEAK</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#lt">lt</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#lt_halfprime">lt_halfprime</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#lteq">lteq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#mult">mult</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#neq">neq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#not">not</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#open">open</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#or_bit">or_bit</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#promise_handler">promise_handler</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#refresh">refresh</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sadd">sadd</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sdiv">sdiv</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#seq">seq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sgt">sgt</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sgteq">sgteq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#slt">slt</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#slteq">slteq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#smod">smod</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#smult">smult</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#smult_bgw">smult_bgw</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sneq">sneq</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sor_bit">sor_bit</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#ssub">ssub</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sub">sub</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#sxor_bit">sxor_bit</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#toString">toString</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#valueOf">valueOf</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#when_both_ready">when_both_ready</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#wThen">wThen</a></li><li data-type='method'><a href="module-jiff-client-JIFFClient_SecretShare.html#xor_bit">xor_bit</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-jiff-client.html">jiff-client</a></li></ul><h3>Namespaces</h3><ul><li><a href="bits.html">bits</a><ul class='methods'><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.bit_composition">jiffClient.protocols.bits.bit_composition</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cadd">jiffClient.protocols.bits.cadd</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cdivl">jiffClient.protocols.bits.cdivl</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cdivr">jiffClient.protocols.bits.cdivr</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.ceq">jiffClient.protocols.bits.ceq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cgt">jiffClient.protocols.bits.cgt</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cgteq">jiffClient.protocols.bits.cgteq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.clt">jiffClient.protocols.bits.clt</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.clteq">jiffClient.protocols.bits.clteq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cmult">jiffClient.protocols.bits.cmult</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.cneq">jiffClient.protocols.bits.cneq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.csubl">jiffClient.protocols.bits.csubl</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.csubr">jiffClient.protocols.bits.csubr</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.open">jiffClient.protocols.bits.open</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.rejection_sampling">jiffClient.protocols.bits.rejection_sampling</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.sadd">jiffClient.protocols.bits.sadd</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.sdiv">jiffClient.protocols.bits.sdiv</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.seq">jiffClient.protocols.bits.seq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.sgt">jiffClient.protocols.bits.sgt</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.sgteq">jiffClient.protocols.bits.sgteq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.share">jiffClient.protocols.bits.share</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.slt">jiffClient.protocols.bits.slt</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.slteq">jiffClient.protocols.bits.slteq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.smult">jiffClient.protocols.bits.smult</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.sneq">jiffClient.protocols.bits.sneq</a></li><li data-type='method'><a href="bits.html#.jiffClient.protocols.bits.ssub">jiffClient.protocols.bits.ssub</a></li></ul></li><li><a href="handlers.html">handlers</a><ul class='methods'><li data-type='method'><a href="handlers.html#.jiffClient.handlers.build_initialization_message">jiffClient.handlers.build_initialization_message</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.connected">jiffClient.handlers.connected</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.error">jiffClient.handlers.error</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.initialized">jiffClient.handlers.initialized</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.receive_crypto_provider">jiffClient.handlers.receive_crypto_provider</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.receive_custom">jiffClient.handlers.receive_custom</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.receive_open">jiffClient.handlers.receive_open</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.receive_share">jiffClient.handlers.receive_share</a></li><li data-type='method'><a href="handlers.html#.jiffClient.handlers.store_public_keys">jiffClient.handlers.store_public_keys</a></li></ul></li><li><a href="helpers.html">helpers</a><ul class='methods'><li data-type='method'><a href="helpers.html#.jiffClient.helpers.array_equals">jiffClient.helpers.array_equals</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.bits_to_number">jiffClient.helpers.bits_to_number</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.bLog">jiffClient.helpers.bLog</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.ceil">jiffClient.helpers.ceil</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.extended_gcd">jiffClient.helpers.extended_gcd</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.floor">jiffClient.helpers.floor</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.get_party_number">jiffClient.helpers.get_party_number</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.is_prime">jiffClient.helpers.is_prime</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.mod">jiffClient.helpers.mod</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.number_to_bits">jiffClient.helpers.number_to_bits</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.pow_mod">jiffClient.helpers.pow_mod</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.random">jiffClient.helpers.random</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.sort_ids">jiffClient.helpers.sort_ids</a></li><li data-type='method'><a href="helpers.html#.jiffClient.helpers.Zp_equals">jiffClient.helpers.Zp_equals</a></li></ul></li><li><a href="hooks.html">hooks</a><ul class='methods'><li data-type='method'><a href="hooks.html#.computeShares">computeShares</a></li><li data-type='method'><a href="hooks.html#.execute_array_hooks">execute_array_hooks</a></li></ul></li><li><a href="protocols.html">protocols</a><ul class='methods'><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_beaver_bgw">jiffClient.protocols.generate_beaver_bgw</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_random_and_quotient">jiffClient.protocols.generate_random_and_quotient</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_random_bit_bgw">jiffClient.protocols.generate_random_bit_bgw</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_random_bit_smult">jiffClient.protocols.generate_random_bit_smult</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_random_bits">jiffClient.protocols.generate_random_bits</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_random_number">jiffClient.protocols.generate_random_number</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.generate_zero">jiffClient.protocols.generate_zero</a></li><li data-type='method'><a href="protocols.html#.jiffClient.protocols.rejection_sampling">jiffClient.protocols.rejection_sampling</a></li></ul></li><li><a href="utils.html">utils</a><ul class='methods'><li data-type='method'><a href="utils.html#.jiffClient.utils.bit_combinator">jiffClient.utils.bit_combinator</a></li><li data-type='method'><a href="utils.html#.jiffClient.utils.many_secret_shares">jiffClient.utils.many_secret_shares</a></li><li data-type='method'><a href="utils.html#.jiffClient.utils.resolve_many_secrets">jiffClient.utils.resolve_many_secrets</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">client/protocols/arrays/share.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const util = require('./util.js');

const share_array = function (jiff, array, lengths, threshold, receivers_list, senders_list, Zp, share_id) {
  var skeletons = null;
  if (lengths != null) {
    // Check format of lengths
    if (lengths != null &amp;&amp; typeof(lengths) !== 'number' &amp;&amp; typeof(lengths) !== 'object') {
      throw new Error('share_array: unrecognized lengths');
    }

    // Get senders list for later checking
    if (senders_list == null) {
      senders_list = [];
      for (i = 1; i &lt;= jiff.party_count; i++) {
        senders_list.push(i);
      }
    }

    // Generate skeletons from lengths
    skeletons = {};
    if (typeof(lengths) === 'number') {
      // All arrays are of the same length
      var skeleton = [];
      for (var i = 0; i &lt; lengths; i++) {
        skeleton.push(null);
      }
      for (i = 0; i &lt; senders_list.length; i++) {
        skeletons[senders_list[i]] = skeleton;
      }
    } else {
      // Lengths of the different arrays are all provided
      for (i = 0; i &lt; senders_list.length; i++) {
        if (lengths[senders_list[i]] == null) {
          throw new Error('share_array: missing length');
        } else {
          skeletons[senders_list[i]] = [];
          for (var j = 0; j &lt; lengths[senders_list[i]]; j++) {
            skeletons[senders_list[i]].push(null);
          }
        }
      }
    }
  }

  return share_ND_array(jiff, array, skeletons, threshold, receivers_list, senders_list, Zp, share_id);
};

const share_2D_array = function (jiff, array, lengths, threshold, receivers_list, senders_list, Zp, share_id) {
  var i;

  // Check format of lengths
  if (lengths != null &amp;&amp; typeof(lengths) !== 'object') {
    throw new Error('share_array: unrecognized lengths');
  }

  // Default values
  if (receivers_list == null) {
    receivers_list = [];
    for (i = 1; i &lt;= jiff.party_count; i++) {
      receivers_list.push(i);
    }
  }
  if (senders_list == null) {
    senders_list = [];
    for (i = 1; i &lt;= jiff.party_count; i++) {
      senders_list.push(i);
    }
  }

  var isReceiving = receivers_list.indexOf(jiff.id) > -1;
  if (senders_list.indexOf(jiff.id) === -1 &amp;&amp; !isReceiving) {
    // This party is neither a sender nor a receiver, do nothing!
    return null;
  }

  // compute operation id
  receivers_list.sort(); // sort to get the same order
  senders_list.sort();
  if (share_id == null) {
    share_id = jiff.counters.gen_share_id(receivers_list, senders_list) + ':array:';
  }

  // wrap around result of share_array
  var lengths_deferred = new jiff.helpers.Deferred();
  var lengths_promise = lengths_deferred.promise;

  // figure out lengths by having each party emit their length publicly
  if (lengths == null) {
    lengths = {};
    var total = 0;
    if (senders_list.indexOf(jiff.id) > -1) {
      lengths[jiff.id] = array.length;

      // send the length of this party's array to all receivers
      jiff.emit(share_id + 'length', receivers_list, array.length.toString(10));
    }

    jiff.listen(share_id + 'length', function (sender, message) {
      lengths[sender] = { rows: parseInt(message, 10) };
      total++;
      if (total === senders_list.length) {
        jiff.remove_listener(share_id + 'length');
        lengths_deferred.resolve(lengths);
      }
    });
  } else if (typeof(lengths.rows) === 'number') {
    // All arrays are of the same length
    var l = lengths;
    lengths = {};
    for (i = 0; i &lt; senders_list.length; i++) {
      lengths[senders_list[i]] = l;
    }

    lengths_deferred.resolve(lengths);
  } else {
    // Lengths of the different arrays are all provided
    for (i = 0; i &lt; senders_list.length; i++) {
      if (lengths[senders_list[i]] == null || lengths[senders_list[i]].rows == null) {
        throw new Error('share_2D_array: missing rows length');
      }
    }

    lengths_deferred.resolve(lengths);
  }

  // Final results
  var share_array_deferred = new jiff.helpers.Deferred();
  var share_array_promise = share_array_deferred.promise;

  // lengths are now set, start sharing
  lengths_promise.then(function (lengths) {
    // compute the number of sharing rounds
    var max = 0;
    for (i = 0; i &lt; senders_list.length; i++) {
      var l = lengths[senders_list[i]].rows;
      max = l > max ? l : max;
    }

    // share every round
    var promises = [];
    for (var r = 0; r &lt; max; r++) {
      var round_senders = [];
      for (i = 0; i &lt; senders_list.length; i++) {
        if (lengths[senders_list[i]].rows > r) {
          round_senders.push(senders_list[i]);
        }
      }

      var row_lengths = {};
      var empty = false;
      for (var p = 0; p &lt; round_senders.length; p++) {
        var pid = round_senders[p];
        row_lengths[pid] = lengths[pid].cols;
        if (lengths[pid][r] != null) {
          row_lengths[pid] = lengths[pid][r];
        }
        if (row_lengths[pid] == null) {
          empty = true;
        }
      }

      var row = r &lt; array.length ? array[r] : [];
      row_lengths = empty ? null : row_lengths;
      var round_results = share_array(jiff, row, row_lengths, threshold, receivers_list, round_senders, Zp, share_id + 'row' + r + ':');
      promises.push(round_results);
    }

    // Wait for every promises corresponding to every row
    return Promise.all(promises).then(function (intermediate_results) {
      // Store results here
      var results = {};
      if (isReceiving) {
        for (i = 0; i &lt; senders_list.length; i++) {
          results[senders_list[i]] = [];
        }
      }

      for (i = 0; i &lt; intermediate_results.length; i++) {
        var round = intermediate_results[i];
        for (var sender_id in round) {
          if (round.hasOwnProperty(sender_id)) {
            results[sender_id].push(round[sender_id]);
          }
        }
      }

      share_array_deferred.resolve(results);
    });
  });

  return isReceiving ? share_array_promise : null;
};

const share_from_skeleton_unbound = function (jiff, that, sender, skeleton) {
  var shares = typeof(skeleton) === 'string' ? JSON.parse(skeleton) : skeleton;

  var promise = share_array_single_sender(jiff, shares, that.threshold, that.receivers_list, sender, that.Zp, that.share_id + ':p_id_' + sender);

  promise.then(function (sender, array) {
    that.deferreds[sender].resolve(array);
  }.bind(null, sender));
};

const share_array_single_sender = function (jiff, secrets, threshold, receivers_list, sender, Zp, share_id) {
  if (secrets != null &amp;&amp; secrets.length === 0) {
    return Promise.resolve([]);
  } else if (secrets != null &amp;&amp; Array.isArray(secrets)) {
    var promised_array = [];
    for (var j = 0; j &lt; secrets.length; j++) {
      promised_array.push(share_array_single_sender(jiff, secrets[j], threshold, receivers_list, sender, Zp, share_id + ':' + j));
    }

    var isReceiving = receivers_list.indexOf(jiff.id) > -1;

    if (isReceiving) {
      var deferred_array = new jiff.helpers.Deferred();
      Promise.all(promised_array).then(function (array) {
        deferred_array.resolve(array);
      });
    }

    return isReceiving ? deferred_array.promise : Promise.resolve({});
  } else {
    // Create and distribute the share - Note: Senders are reorganized in the final array.
    // The return value of jiff.share is an array, [sender: share], and we only need to return share by itself.
    return Promise.resolve(jiff.share(secrets, threshold, receivers_list, [sender], Zp, 'share:' + share_id)[sender]);
  }
};

/**
 * Helper function of share_ND_array
 * This method gets called if share_ND_array does not have enough information
 *                 to output an array of shares immediately.  Instead it
 *                 returns a promise to an object holding the unknown-size
 *                 arrays from each sender.
 * @method share_ND_array_deferred
 * @memberof module:jiff-client~JIFFClient
 * @instance
 * @returns {promise}
 */
const share_ND_array_deferred = function (jiff, secrets, skeletons, threshold, receivers_list, senders_list, Zp, share_id) {
  var parameters = [receivers_list, senders_list, threshold, Zp, share_id];
  [receivers_list, senders_list, threshold, Zp, share_id] = util.sanitize_array_params.bind(null, jiff).apply(null, parameters);

  var i, p_id, skeleton;

  var isReceiving = receivers_list.indexOf(jiff.id) > -1;
  var isSending = senders_list.indexOf(jiff.id) > -1;
  if (!isSending &amp;&amp; !isReceiving) {
    return null;  // This party is neither a sender nor a receiver, do nothing!
  }

  // Setup deferreds: required because we don't yet know how many shares to account for
  var final_deferreds = [];
  for (i = 0; i &lt; senders_list.length; i++) {
    p_id = senders_list[i];
    final_deferreds[p_id] = new jiff.helpers.Deferred();
  }

  const share_from_skeleton = share_from_skeleton_unbound.bind(null, jiff).bind(null, {
    deferreds: final_deferreds,
    threshold: threshold,
    receivers_list: receivers_list,
    Zp: Zp, share_id: share_id
  });

  if (skeletons == null) {
    if (isSending) {  // Send the shape and lengths of this party's array to all receivers
      skeleton = jiff.skeleton_of(secrets);  // All secrets are removed while maintaing the array's orginial structure.
      var skeleton_str = JSON.stringify(skeleton);  // serialize for emit
      jiff.emit(share_id + 'skeleton', receivers_list, skeleton_str);
      share_from_skeleton(jiff.id, secrets);  // Share the real values matching the emitted skeleton
    }
    if (isReceiving) {
      jiff.listen(share_id + 'skeleton', share_from_skeleton);  // Receive shares when dimensions are known
    }
  } else {
    senders_list = Array.from(senders_list);  // remove jiff helpers' internal properties
    util.match_skeletons(jiff, skeletons, senders_list);  // Saftey check array dimention presets
    for (i in senders_list) {  // Share each party's array
      p_id = senders_list[i];
      var myself = p_id === jiff.id;
      skeleton = skeletons[p_id];
      share_from_skeleton(p_id, myself ? secrets : skeleton);
    }
  }


  // Combine all promises and re-index final array map
  var final_deferred = new jiff.helpers.Deferred();
  var final_promise = isReceiving ? final_deferred.promise : Promise.resolve({});
  Promise.all((function () {
    var all_promises = [];
    for (var i = 0; i &lt; senders_list.length; i++) {
      var p_id = senders_list[i]
      all_promises.push(final_deferreds[p_id].promise);
    }
    return all_promises;
  })()).then(function (array) {
    var shares = {};
    for (var i = 0; i &lt; senders_list.length; i++) {
      var p_id = senders_list[i];
      shares[p_id] = array[i];
    }
    final_deferred.resolve(shares);
    jiff.remove_listener(share_id + 'skeleton');
  });

  return final_promise;  // Return promise to map of secret-shared arrays
};

/**
 * Helper function of share_ND_array
 * This method gets called if share_ND_array when share_ND_array was given
 *                 sufficients information (in the form of array skeletons) to
 *                 infer the size and shape of each of the senders' arrays.
 *                 This allows it to immediately return an object containing
 *                 the secret-shared arrays from each sender.
 * @method share_ND_array_static
 * @memberof module:jiff-client~JIFFClient
 * @instance
 * @returns {object}
 */
const share_ND_array_static = function (jiff, secrets, skeletons, threshold, receivers_list, senders_list, Zp, share_id) {
  var parameters = [receivers_list, senders_list, threshold, Zp, share_id];
  [receivers_list, senders_list, threshold, Zp, share_id] = util.sanitize_array_params.bind(null, jiff).apply(null, parameters);

  var i;

  var shares = {};

  var isReceiving = receivers_list.indexOf(jiff.id) > -1;
  var isSending = senders_list.indexOf(jiff.id) > -1;
  if (isSending || isReceiving) {
    // Static version of share_from_skeleton
    const share_from_skeleton = function (sender, skeleton) {
      return (function share_recursive(__secrets, share_id) {
        if (__secrets != null &amp;&amp; __secrets.length === 0) {
          return [];
        } else if (__secrets != null &amp;&amp; Array.isArray(__secrets)) {
          var array = [];
          for (var j = 0; j &lt; __secrets.length; j++) {
            array.push(share_recursive(__secrets[j], share_id + ':' + j));
          }
          return isReceiving ? array : {};
        } else {
          return jiff.share(__secrets, threshold, receivers_list, [sender], Zp, 'share:' + share_id)[sender];
        }
      })(skeleton, share_id + ':p_id_' + sender);
    }

    senders_list = Array.from(senders_list);  // remove jiff helpers' internal properties
    util.match_skeletons(jiff, skeletons, senders_list);  // Saftey check array dimention presets
    for (i in senders_list) {  // Share each party's array
      var p_id = senders_list[i];
      var skeleton = skeletons[p_id];
      shares[p_id] = share_from_skeleton(p_id, p_id === jiff.id ? secrets : skeleton);
    }
  }

  return isReceiving ? shares : {};  // Return promise to map of secret-shared arrays
};

const share_ND_array = function (jiff, secrets, skeletons, threshold, receivers_list, senders_list, Zp, share_id) {
  var share_ND_array = skeletons != null ? share_ND_array_static : share_ND_array_deferred;
  return share_ND_array(jiff, secrets, skeletons, threshold, receivers_list, senders_list, Zp, share_id);
};

module.exports = {
  share_array: share_array,
  share_2D_array: share_2D_array,
  share_ND_array: share_ND_array
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.5</a> on Mon Aug 10 2020 17:12:18 GMT-0400 (Eastern Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
